image: node:20

stages:
  - test
  - build

cache:
  paths:
    - node_modules/
    - backend/node_modules/
    - frontend/node_modules/

before_script:
  # Install dependencies for root, backend, and frontend
  - npm install
  - npm install --prefix backend
  - npm install --prefix frontend

# ---- TEST JOBS ----

test_root:
  stage: test
  script:
    - npm test

test_backend:
  stage: test
  script:
    - cd backend
    - npm test

test_frontend:
  stage: test
  script:
    - cd frontend
    - npm test

# ---- OPTIONAL BUILD JOBS (REMOVE IF YOU DON'T NEED THEM YET) ----

build_backend:
  stage: build
  script:
    - cd backend
    - npm run build

build_frontend:
  stage: build
  script:
    - cd frontend
    - npm run build