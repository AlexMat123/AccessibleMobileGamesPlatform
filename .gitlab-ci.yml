image: node:20

stages:
  - test
  - build

cache:
  paths:
    - node_modules/
    - backend/node_modules/
    - frontend/node_modules/

before_script:
  # Install dependencies for root, backend, and frontend
  - npm install
  - npm install --prefix backend
  - npm install --prefix frontend

# ---- TEST JOB ----
test_all:
  stage: test
  script:
    - npm test

# ---- OPTIONAL BUILD JOBS ----
build_backend:
  stage: build
  script:
    - cd backend
    - npm run build

build_frontend:
  stage: build
  script:
    - cd frontend
    - npm run build
